from pathlib import Path

path = "/mnt/data/theme1_yspu_sales.html"

html = """<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>分析主题一 · YSPU 销售表现</title>
<script src="https://cdn.jsdelivr.net/npm/echarts@5"></script>
<style>
  *{box-sizing:border-box}
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;background:#f5f6f8;margin:0;padding:24px;color:#222}
  h1{font-size:26px;margin:0 0 6px}
  .subtitle{color:#555;margin:0 0 18px;line-height:1.45}
  .panel{background:#fff;border-radius:14px;padding:16px 20px;margin:0 0 18px;box-shadow:0 2px 10px rgba(0,0,0,.06)}
  .filters{display:grid;grid-template-columns:220px 220px 220px 180px 220px 260px;gap:14px}
  .filter-item{display:flex;flex-direction:column;font-size:13px}
  .filter-item label{margin:0 0 6px;color:#666}
  .filter-item select,.filter-item input{padding:8px 10px;border-radius:8px;border:1px solid #d5d9e0;background:#fff}
  .filter-item select[multiple]{height:86px}
  .hint{font-size:12px;color:#888;margin-top:6px}

  .kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
  .kpi-card{background:#fff;border-radius:14px;padding:14px 16px;box-shadow:0 2px 10px rgba(0,0,0,.06);position:relative;min-height:90px}
  .kpi-title{font-size:14px;color:#555;margin:0 0 6px}
  .kpi-main{font-size:22px;font-weight:800;letter-spacing:.2px}
  .kpi-sub{font-size:12px;color:#777;margin-top:4px;line-height:1.35}

  /* Hover tooltip for KPI cards */
  .kpi-card[data-tip]:hover::after{
    content:attr(data-tip);
    position:absolute;
    bottom:110%;
    left:12px;
    background:#111;
    color:#fff;
    font-size:12px;
    padding:7px 9px;
    border-radius:8px;
    white-space:nowrap;
    z-index:20;
    box-shadow:0 10px 28px rgba(0,0,0,.25);
  }
  .kpi-card[data-tip]:hover::before{
    content:"";
    position:absolute;
    bottom:104%;
    left:18px;
    border:7px solid transparent;
    border-top-color:#111;
    z-index:20;
  }

  .tabs{display:flex;gap:10px;margin:0 0 12px}
  .tab{padding:9px 16px;border-radius:10px;background:#eef1f6;cursor:pointer;font-size:14px;user-select:none;border:1px solid #e2e6ee}
  .tab.active{background:#2a5cff;color:#fff;border-color:#2a5cff}
  .tab.disabled{opacity:.5;cursor:not-allowed}

  .hidden{display:none}
  .chart-row{display:flex;gap:14px;align-items:stretch}
  .chart-box{flex:1;min-height:320px;background:#fff;border-radius:14px;padding:10px 10px 12px;box-shadow:0 2px 10px rgba(0,0,0,.06)}
  .chart-note{font-size:13px;color:#666;margin:8px 4px 0;line-height:1.45}
  .metric-row{display:flex;gap:14px;margin-top:14px;flex-wrap:wrap}
  .metric-row .kpi-card{flex:1;min-width:240px}

  @media (max-width:1200px){
    .filters{grid-template-columns:1fr 1fr}
    .kpi-grid{grid-template-columns:1fr 1fr}
    .chart-row{flex-direction:column}
  }
</style>
</head>
<body>

<h1>分析主题一：YSPU 销售表现</h1>
<div class="subtitle">
  目标：识别主销品和搭售件的销售趋势，对销量偏差做初步拆解（搭售件：单独销售不达预期 or 搭售销量不达预期）
</div>

<!-- 顶部筛选（不丢项） -->
<div class="panel">
  <div class="filters">
    <div class="filter-item">
      <label>销售时间</label>
      <input id="dateRange" value="2025-11-01 ~ 2025-11-30"/>
      <div class="hint">示例：20251101-20251130（demo 不做校验）</div>
    </div>

    <div class="filter-item">
      <label>场景（可多选）</label>
      <select id="sceneSelect" multiple>
        <option selected>基础场景</option>
        <option>行政场景</option>
        <option>H 场景</option>
        <option>S 场景</option>
      </select>
    </div>

    <div class="filter-item">
      <label>国家（可多选）</label>
      <select id="countrySelect" multiple>
        <option selected>US</option>
        <option>DE</option>
        <option>UK</option>
      </select>
    </div>

    <div class="filter-item">
      <label>类型</label>
      <select id="typeSelect">
        <option value="main">主销品</option>
        <option value="attach">搭售件</option>
      </select>
    </div>

    <div class="filter-item">
      <label>YSPU</label>
      <select id="yspuSelect"></select>
    </div>

    <div class="filter-item">
      <label>YSKU</label>
      <select id="yskuSelect"></select>
      <div class="hint" id="yskuHint">主销品=YSPU+尺寸+颜色；搭售件=YSPU+尺寸+颜色</div>
    </div>
  </div>
</div>

<!-- KPI（完整） -->
<div class="kpi-grid">
  <div class="kpi-card" data-tip="实际销量：已售出的总件数（示例）">
    <div class="kpi-title">销量</div>
    <div class="kpi-main" id="kpiTotalQty">1,280</div>
    <div class="kpi-sub" id="kpiTotalQtySub">预计 1,400 ｜ 偏差 -120</div>
  </div>

  <div class="kpi-card" data-tip="单独销量：未通过搭售产生的销量（示例）">
    <div class="kpi-title">单独销量</div>
    <div class="kpi-main" id="kpiIndQty">860</div>
    <div class="kpi-sub" id="kpiIndQtySub">预计 950 ｜ 偏差 -90</div>
  </div>

  <div class="kpi-card" data-tip="搭售销量：通过与主销品一起销售产生的销量（仅类型=搭售件适用）">
    <div class="kpi-title">搭售销量</div>
    <div class="kpi-main" id="kpiAttQty">420</div>
    <div class="kpi-sub" id="kpiAttQtySub">预计 450 ｜ 偏差 -30</div>
  </div>

  <div class="kpi-card" data-tip="销售额：销量×件单价（示例）">
    <div class="kpi-title">销售额</div>
    <div class="kpi-main" id="kpiRevenue">$512,000</div>
    <div class="kpi-sub" id="kpiRevenueSub">月环比：+3.2%（示例）</div>
  </div>

  <div class="kpi-card" data-tip="件单价：单件商品平均成交价（实际）">
    <div class="kpi-title">件单价（实际）</div>
    <div class="kpi-main" id="kpiUnitPrice">$400</div>
    <div class="kpi-sub">备注：实际件单价</div>
  </div>

  <div class="kpi-card" data-tip="运营利润额（示例）：销售收入-成本-推广费用">
    <div class="kpi-title">运营利润额</div>
    <div class="kpi-main" id="kpiOpProfit">$138,000</div>
    <div class="kpi-sub">月环比：-1.1%（示例）</div>
  </div>

  <div class="kpi-card" data-tip="运营利润率 = 运营利润额 / 销售额（示例）">
    <div class="kpi-title">运营利润率</div>
    <div class="kpi-main" id="kpiOpMargin">27%</div>
    <div class="kpi-sub" id="kpiOpMarginSub">较上月：-1.2pp（示例）</div>
  </div>

  <div class="kpi-card" data-tip="推广费占比 = 广告推广费用 / 销售额（YSKU 维度不适用）">
    <div class="kpi-title">推广费占比</div>
    <div class="kpi-main" id="kpiAdRatio">18%</div>
    <div class="kpi-sub" id="kpiAdRatioSub">YSKU 维度不适用</div>
  </div>
</div>

<!-- 拆解区：Tab -->
<div class="panel">
  <div class="tabs">
    <div class="tab active" id="tabInd">独立销量</div>
    <div class="tab" id="tabAtt">搭售销量</div>
  </div>

  <!-- 独立销量 -->
  <div id="indBlock">
    <div class="chart-row">
      <div class="chart-box" id="indTrend"></div>
    </div>
    <div class="chart-note">本图回答的问题：独立销量的变化，是“流量变化”导致，还是“转化/购买件数变化”导致？</div>

    <div class="metric-row">
      <div class="kpi-card" data-tip="流量：产品详情页 session（示例）">
        <div class="kpi-title">流量</div>
        <div class="kpi-main" id="kpiTraffic">24,000</div>
        <div class="kpi-sub" id="kpiTrafficSub">预计 26,000 ｜ 偏差 -2,000</div>
      </div>

      <div class="kpi-card" data-tip="订单转化率：独立销售订单数 / 产品详情页session（示例）">
        <div class="kpi-title">订单转化率</div>
        <div class="kpi-main" id="kpiCVR">3.6%</div>
        <div class="kpi-sub" id="kpiCVRSub">预计 3.9% ｜ 偏差 -0.3pp</div>
      </div>

      <div class="kpi-card" data-tip="平均购买件数：平均每订单销量（示例）">
        <div class="kpi-title">平均购买件数</div>
        <div class="kpi-main" id="kpiAUP">1.12</div>
        <div class="kpi-sub" id="kpiAUPSub">预计 1.18 ｜ 偏差 -0.06（平均每订单销量）</div>
      </div>
    </div>
  </div>

  <!-- 搭售销量 -->
  <div id="attBlock" class="hidden">
    <div class="chart-row">
      <div class="chart-box" id="attCompare"></div>
      <div class="chart-box" id="attDev"></div>
    </div>
    <div class="chart-note">
      左图回答的问题：该搭售件在不同主销品下“搭售量是否达标”，同时搭售率是否偏低？（柱：搭售量；线：搭售率）<br/>
      右图回答的问题：搭售偏差主要发生在哪些主销品（实际-预计）？
    </div>
  </div>
</div>

<script>
/** ========= 枚举（按你确认的口径） ========= */
const mainSPUList = ["v0.7整桌","柜子","实木贴皮","H风格套系","W风格套系","v0.7Home","夹式排插","电子类独立配件","0.7Edge"];
const attachSPUList = ["小高台","下抽屉","柜子"];

const mainYSKU = {
  "v0.7整桌": ["v0.7整桌 | 140×70 | 白色","v0.7整桌 | 160×80 | 黑色"],
  "柜子": ["柜子 | 双抽 | 白色","柜子 | 单抽 | 黑色"],
  "实木贴皮": ["实木贴皮 | 140×70 | 胡桃木","实木贴皮 | 160×80 | 原木色"],
  "H风格套系": ["H风格套系 | 标准 | 黑色","H风格套系 | 加宽 | 白色"],
  "W风格套系": ["W风格套系 | 标准 | 黑色","W风格套系 | 加宽 | 白色"],
  "v0.7Home": ["v0.7Home | 140×70 | 白色","v0.7Home | 160×80 | 黑色"],
  "夹式排插": ["夹式排插 | 标准 | 黑色","夹式排插 | 标准 | 白色"],
  "电子类独立配件": ["电子类独立配件 | 标准 | 黑色","电子类独立配件 | 标准 | 白色"],
  "0.7Edge": ["0.7Edge | 140×70 | 白色","0.7Edge | 160×80 | 黑色"]
};

const attachYSKU = {
  "小高台": ["小高台 | 标准 | 黑色","小高台 | 加宽 | 白色"],
  "下抽屉": ["下抽屉 | 标准 | 黑色","下抽屉 | 加宽 | 白色"],
  "柜子": ["柜子(搭售) | 双抽 | 白色","柜子(搭售) | 单抽 | 黑色"]
};

/** ========= 图表实例（Lazy Init：彻底避免 display:none 初始化导致 0 宽高） ========= */
let indChart = null;
let attCompareChart = null;
let attDevChart = null;

function raf2(fn){
  requestAnimationFrame(()=>requestAnimationFrame(fn));
}

function ensureIndChart(){
  if(indChart) return;
  indChart = echarts.init(document.getElementById("indTrend"));
  indChart.setOption({
    title:{text:"独立销量月度趋势"},
    tooltip:{trigger:"axis"},
    xAxis:{type:"category",data:["7月","8月","9月","10月","11月"]},
    yAxis:{type:"value"},
    series:[{name:"独立销量",type:"line",data:[720,760,810,830,860]}]
  });
}

function ensureAttCharts(){
  if(attCompareChart && attDevChart) return;
  attCompareChart = echarts.init(document.getElementById("attCompare"));
  attDevChart = echarts.init(document.getElementById("attDev"));
  renderAttCharts();
}

function renderAttCharts(){
  const expectedQty = [180,120,90,160,110,140,100,80,60];
  const actualQty   = [150, 95,70,130, 85,120, 90,60,40];
  const deviation   = actualQty.map((v,i)=>v-expectedQty[i]);

  const expectedRate = [22,18,15,20,17,19,16,14,12];
  const actualRate   = [18,14,11,16,13,15,12,10, 8];

  attCompareChart.setOption({
    title:{text:"搭售量与搭售率（预计 vs 实际）"},
    tooltip:{trigger:"axis"},
    legend:{data:["预计搭售量","实际搭售量","预计搭售率","实际搭售率"]},
    grid:{left:50,right:70,top:62,bottom:40},
    xAxis:{type:"category",data:mainSPUList,axisLabel:{interval:0,rotate:20}},
    yAxis:[
      {type:"value",name:"搭售量"},
      {type:"value",name:"搭售率(%)",axisLabel:{formatter:"{value}%"}}
    ],
    series:[
      {name:"预计搭售量",type:"bar",data:expectedQty,itemStyle:{color:"#cfd8ff"}},
      {name:"实际搭售量",type:"bar",data:actualQty,itemStyle:{color:"#2a5cff"}},
      {name:"预计搭售率",type:"line",yAxisIndex:1,data:expectedRate,lineStyle:{type:"dashed",width:2},symbol:"circle"},
      {name:"实际搭售率",type:"line",yAxisIndex:1,data:actualRate,lineStyle:{width:3},symbol:"circle"}
    ]
  });

  attDevChart.setOption({
    title:{text:"搭售偏差（实际 - 预计）"},
    tooltip:{trigger:"axis"},
    grid:{left:50,right:30,top:62,bottom:40},
    xAxis:{type:"category",data:mainSPUList,axisLabel:{interval:0,rotate:20}},
    yAxis:{type:"value"},
    series:[{
      name:"偏差",
      type:"bar",
      data:deviation,
      itemStyle:{color:(p)=>p.value>=0?"#4caf50":"#e53935"}
    }]
  });
}

function activateTab(which){
  const tabInd = document.getElementById("tabInd");
  const tabAtt = document.getElementById("tabAtt");
  const indBlock = document.getElementById("indBlock");
  const attBlock = document.getElementById("attBlock");

  if(which==="ind"){
    tabInd.classList.add("active");
    tabAtt.classList.remove("active");
    indBlock.classList.remove("hidden");
    attBlock.classList.add("hidden");
    ensureIndChart();
    raf2(()=>indChart && indChart.resize());
  }else{
    tabAtt.classList.add("active");
    tabInd.classList.remove("active");
    attBlock.classList.remove("hidden");
    indBlock.classList.add("hidden");
    raf2(()=>{
      ensureAttCharts();
      attCompareChart && attCompareChart.resize();
      attDevChart && attDevChart.resize();
    });
  }
}

function setOptions(selectEl, list){
  selectEl.innerHTML = "";
  list.forEach(v=>{
    const o = document.createElement("option");
    o.value = v;
    o.textContent = v;
    selectEl.appendChild(o);
  });
}

function updateYSKU(){
  const type = document.getElementById("typeSelect").value;
  const spu = document.getElementById("yspuSelect").value;
  const yskuSelect = document.getElementById("yskuSelect");
  const list = (type==="main") ? (mainYSKU[spu]||[]) : (attachYSKU[spu]||[]);
  setOptions(yskuSelect, list);
}

function applyTypeRules(){
  const type = document.getElementById("typeSelect").value;
  const yspuSelect = document.getElementById("yspuSelect");
  setOptions(yspuSelect, type==="main" ? mainSPUList : attachSPUList);
  updateYSKU();

  // 主销品：搭售销量=0；单独销量=销量
  const totalQty = document.getElementById("kpiTotalQty").textContent;
  if(type==="main"){
    document.getElementById("kpiAttQty").textContent = "0";
    document.getElementById("kpiAttQtySub").textContent = "仅类型=搭售件适用";
    document.getElementById("kpiIndQty").textContent = totalQty;
    document.getElementById("kpiIndQtySub").textContent = "等于销量（类型=主销品）";
    activateTab("ind");
  }else{
    // 搭售件：恢复示例值（保持原赋值）
    document.getElementById("kpiIndQty").textContent = "860";
    document.getElementById("kpiIndQtySub").textContent = "预计 950 ｜ 偏差 -90";
    document.getElementById("kpiAttQty").textContent = "420";
    document.getElementById("kpiAttQtySub").textContent = "预计 450 ｜ 偏差 -30";
    activateTab("att"); // 默认进入搭售销量，确保不空
  }
}

document.getElementById("tabInd").addEventListener("click", ()=>activateTab("ind"));
document.getElementById("tabAtt").addEventListener("click", ()=>activateTab("att"));
document.getElementById("typeSelect").addEventListener("change", applyTypeRules);
document.getElementById("yspuSelect").addEventListener("change", updateYSKU);

// 初始化
ensureIndChart();
applyTypeRules();

window.addEventListener("resize", ()=>{
  raf2(()=>{
    indChart && indChart.resize();
    attCompareChart && attCompareChart.resize();
    attDevChart && attDevChart.resize();
  });
});
</script>

</body>
</html>
"""

path = "/mnt/data/theme1_yspu_sales.html"
Path(path).write_text(html, encoding="utf-8")
path
